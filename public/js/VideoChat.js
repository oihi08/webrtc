/**
 * VideoChat - 
 * @version v1.0.0
 * @link    
 * @author   ()
 * @license ISC
 */
(function(){var VC;VC={socket:io("http://filmit.watch:3000"),requestMediaStream:function(){return getUserMedia({video:!0,audio:!0},VC.onMediaStream,VC.noMediaStream)},onMediaStream:function(stream){return VC.localVideo=document.getElementById("local-video"),VC.localVideo.volume=0,VC.localStream=stream,VC.videoButton.setAttribute("disabled","disabled"),VC.localVideo.src=window.URL.createObjectURL(stream),VC.socket.emit("join","test"),VC.socket.on("ready",VC.readyToCall),VC.socket.on("offer",VC.onOffer)},noMediaStream:function(){return console.log("No media stream for us.")},readyToCall:function(){return VC.callButton.removeAttribute("disabled")},startCall:function(){return VC.socket.on("token",VC.onToken(VC.createOffer)),VC.socket.emit("token")},onToken:function(callback){return function(token){VC.peerConnection=new RTCPeerConnection({iceServers:token.iceServers}),VC.peerConnection.addStream(VC.localStream),VC.peerConnection.onicecandidate=VC.onIceCandidate,VC.peerConnection.onaddstream=VC.onAddStream,VC.socket.on("candidate",VC.onCandidate),VC.socket.on("answer",VC.onAnswer),callback()}},onIceCandidate:function(event){return event.candidate?VC.socket.emit("candidate",JSON.stringify(event.candidate)):void 0},onCandidate:function(candidate){var rtcCandidate;return rtcCandidate=new RTCIceCandidate(JSON.parse(candidate)),VC.peerConnection.addIceCandidate(rtcCandidate)},createOffer:function(){return VC.peerConnection.createOffer(function(offer){return VC.peerConnection.setLocalDescription(offer),VC.socket.emit("offer",JSON.stringify(offer))})},createAnswer:function(offer){return function(){var rtcOffer;rtcOffer=new RTCSessionDescription(JSON.parse(offer)),VC.peerConnection.setRemoteDescription(rtcOffer),VC.peerConnection.createAnswer(function(answer){VC.peerConnection.setLocalDescription(answer),VC.socket.emit("answer",JSON.stringify(answer))},function(error){console.log("error",error)})}},onOffer:function(offer){return VC.socket.on("token",VC.onToken(VC.createAnswer(offer))),VC.socket.emit("token")},onAnswer:function(answer){var rtcAnswer;return rtcAnswer=new RTCSessionDescription(JSON.parse(answer)),VC.peerConnection.setRemoteDescription(rtcAnswer)},onAddStream:function(event){return VC.remoteVideo=document.getElementById("remote-video"),VC.remoteVideo.src=window.URL.createObjectURL(event.stream)}},VC.videoButton=document.getElementById("get-video"),VC.videoButton.addEventListener("click",VC.requestMediaStream,!1),VC.callButton=document.getElementById("call"),VC.callButton.addEventListener("click",VC.startCall,!1)}).call(this);